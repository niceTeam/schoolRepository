<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../font-awesome-4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/sjmb.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
 	<link rel="stylesheet" href="../css/xssy.css">
    <style type="text/css">
       header{
            color: white;
            height: 10%;
            width: 100%;
            position: fixed;
            background-color: #78c5f4;
			z-index: 12;left:0;
            font-size: 25px;
            -webkit-box-shadow: -4px 6px 5px -4px #cfcfcf;
        }
        header a{color: white;font-size: 20px;margin-left: 30px}       
        a{text-decoration:none;}
        .dgtmda a{color:#337ab7}
    </style>
</head>
<body  style="  background-color: #e6ecee;">

<div class="cyy" style="display:none;top:0;left:0;height: 1500px"></div>

<div id="csbg" style="display: none;">
    <h4 class="bt">答题报告</h4>
    <p class="jstm">共 <label>10 </label> 题，答对 <label>5 </label> 题
        <a><input type="button" value="查看解析" class="ckjx"></a>
        <a href='xszy'><input type="button" value="退出" class="tc"></a>
    </p>
    <div class="tmxh">
        <div><a>1</a></div>
        <div><a>2</a></div>
        <div><a>3</a></div>
        <div class="clear" style="border: 0;"></div>
    </div>
    <p class="tjsj">提交时间：<span>2018年7月21日 20:20:14</span></p>
    <div class="df" style="display: block;">得分：<label>50</label></div>
</div>


<header>
	<div style="margin-top: 10px">
	    <label style="margin-top: 10px;margin-left:-50px;font-weight: 700;">云 题 库</label>
	    <a style="margin-left: 30px;border: 1px solid white;font-size: 25px"></a>
	    <a href="xszy" onclick="wdzc()">我的自测</a>
	    <a href="tycs">统一测试</a>
	    <a href="dtls">历史答题</a>
	    <a style="margin-left: 550px;font-size: 17px"><i class="fa fa-user-o" style="font-size: 22px"></i> &nbsp;<span th:text="${xname}" class="xname"></span></a>
	    <span th:text="${xid}" class="xid" style="display: none"></span>
	    <span th:text="${ksid}" class="ksid" style="display: none"></span>
	    <span th:text="${sjid}" class="sjid" style="display: none"></span>
	    <span th:text="${djs}" class="djs" style="display: none"></span>
	     <span th:text="${jssj}" class="jssj" style="display: none"></span>
	    <span class="kssj" style="display: none;"> </span>
	    <a style="font-size: 17px" href="dl"><i class="fa fa-power-off"></i> &nbsp;退出</a>
    </div>
</header>

<div class="dtk">
   <div class="dtk2">答题卡</div>
   
    <p class="sysj">剩余时间:</p>
    
    <div style="height: 58px">
	    <form role="form">
	        <div class="time">
	            <div class="digit minutes">
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	            </div>
	            <div class="digit minutes">
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	            </div>
	            <div class="separator"></div>
	            <div class="digit seconds">
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	            </div>
	            <div class="digit seconds">
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	                <div class="segment"></div>
	            </div>
	        </div>
	    </form>
    </div>
    
    
    <div class="dgtmda" style="overflow: auto;margin-top: 10px">
    
        	<!--  答题卡题号  -->

        <div class="clear" style="border: 0"></div>
        
    </div>
    
    <div class="tijiao"><input type="button" value="提交"></div>
    
</div>

<div class="sjmb">
    <div class="tou" id="1idnex">
    	共 <label class="tmsl"></label> 题，合计 <label class="tmzf"></label> 分
    </div>
    <span style="display: none;" class="dgtmfs"></span>
    <div class='shijuannr'>
			<!-- 试卷题目  -->
	</div>
</div>

<script type="text/javascript" src="../js/jquery.min.js"></script>
<script src="../js/countdown.js" type="text/javascript"></script>
<script src="../js/jquery-3.2.1.js"></script>
<script>
$(function (){
	zdjj();
	
	var today;
    today = new Date();
    intYears = today.getFullYear(); //得到年份,getFullYear()比getYear()更普适
    intMonths = today.getMonth() + 1; //得到月份，要加1
    intDays = today.getDate(); //得到日期
    intHours = today.getHours(); //得到小时 
    intMinutes = today.getMinutes(); //得到分钟
   
    if(intMonths<10){
    	intMonths="0"+intMonths;
    }
    if(intDays<10){
    	intDays="0"+intDays;
    }
    if(intHours<10){
    	intHours="0"+intHours;
    }
    if(intMinutes<10){
    	intMinutes="0"+intMinutes;
    }
    var kssj=intYears+"-"+intMonths+"-"+intDays+" "+intHours+":"+intMinutes;
	$(".kssj").html(kssj);
    
	
    cxsjxx();
    cxsjtm();
    
    $(".ckjx").click(function(){
    	
    	var sjid=$(".sjid").html();
    	location.href="stjx?zt=2&sjid="+sjid;
    })
    
    $(".tijiao").click(function(){
    	
    	tjksxx();
    })
    
    
    
})

function tjksxx(){

	var param=[];
	var a=$(".shijuannr .dgtm");
	
	for(var i=0;i<a.length;i++){
		
		var xxxh="";//你选择的答案
		var c=$(a[i]).find("input");
		
		for(var is=0;is<c.length;is++){
			
			 if($(c[is]).prop("checked")==true){
				 
    			   xxxh+=$(c[is]).next().html();            			  
    		   }
		}
		
		 var dx={'examId':$(".ksid").html(),'qtId':$(a[i]).attr("tmid"),'stuId':$(".xid").html(),'saAnswer':xxxh};
		  param.push(dx);
	}
	 
	   $.ajax({
			type:"POST",
			url:"xzksdaan",
			dataType:"json",
		    contentType:"application/json",
			data:JSON.stringify(param),
			success:function(res){					
				alert("提交成功！");
				xgksryzt();
			}
		});   
}
function zdjj(){
	var jssj=$(".jssj").html();
	var todays;
    todays = new Date();
    intYears = todays.getFullYear(); //得到年份,getFullYear()比getYear()更普适
    intMonths = todays.getMonth() + 1; //得到月份，要加1
    intDays = todays.getDate(); //得到日期
    intHours = todays.getHours(); //得到小时 
    intMinutes = todays.getMinutes(); //得到分钟
    ms = todays.getSeconds(); //获取当前秒数(0-59)
    if(intMonths<10){
    	intMonths="0"+intMonths;
    }
    if(intDays<10){
    	intDays="0"+intDays;
    }
    if(intHours<10){
    	intHours="0"+intHours;
    }
    if(intMinutes<10){
    	intMinutes="0"+intMinutes;
    }
    var xtsj=intYears+"-"+intMonths+"-"+intDays+" "+intHours+":"+intMinutes+":"+ms;
    
    var date1 = new Date(jssj);
	var date2 = new Date(xtsj);
	var s1 = date1.getTime(),s2 = date2.getTime();
	
    if((s2-s1)>=0){
    	tjksxx();
    }else{
    	
    setTimeout("zdjj()",10000); 
    }
}
//修改考试人员状态
function xgksryzt(){
	
	 $("#csbg .tmxh").html("");
	var sjid=$(".sjid").html();
	var stuid=$(".xid").html();
	var tmfs=$(".dgtmfs").html();
	var yes=0;//答对几道题
	var zf=0;//总分
	var param=[];
	var a=$(".shijuannr .dgtm");
		
	for(var i=0;i<a.length;i++){
		
		var xxxh="";//你选择的答案
		var zqda=""//正确答案
		var div="background-color: red";
		var as="color: white";
		
		var c=$(a[i]).find("input");
				
		for(var is=0;is<c.length;is++){
			
			 if($(c[is]).prop("checked")==true){
				 
				   xxxh+=$(c[is]).next().html();            			  
			   }
			 
			 if($(c[is]).attr("isright")=="1"){
				 zqda+=$(c[is]).next().html();
			 }
		}
		 
		 if(zqda==xxxh){
			 zf+=parseInt(tmfs);
			 div="background-color:#0088db";
			 as="color:white";
			 yes++;
		 }
		 
		 $("#csbg .tmxh").append("<div style='"+div+"'>"
 				+"<a style='"+as+"' href='stjx?zt=2&sjid="+sjid+"'>"+(i+1)+"</a></div>");
	}
		
	  var kssj=$(".kssj").html();
	  $.getJSON("xgksryqk?kssj="+kssj+"&jjfs=1&score="+zf+"&stuid="+stuid+"&ksid="+sjid,function(date){
		  alert("修改成功！");
	  })
	
	$("#csbg .jstm label:eq(0)").html(a.length);
	$("#csbg .jstm label:eq(1)").html(yes);
	var sj=dqsj();
	$("#csbg .tjsj span").html(sj);
	$(".df label").html(zf);
	$("#csbg").show();
	$(".cyy").show();
}

function dqsj(){
	var todays;
    todays = new Date();
    intYears = todays.getFullYear(); //得到年份,getFullYear()比getYear()更普适
    intMonths = todays.getMonth() + 1; //得到月份，要加1
    intDays = todays.getDate(); //得到日期
    intHours = todays.getHours(); //得到小时 
    intMinutes = todays.getMinutes(); //得到分钟
    if(intMonths<10){
    	intMonths="0"+intMonths;
    }
    if(intDays<10){
    	intDays="0"+intDays;
    }
    if(intHours<10){
    	intHours="0"+intHours;
    }
    if(intMinutes<10){
    	intMinutes="0"+intMinutes;
    }
    var xtsj=intYears+"-"+intMonths+"-"+intDays+" "+intHours+":"+intMinutes;
    return xtsj;
}

function cxsjxx(){
	var sjid=$(".sjid").html();
	$.getJSON("cxygsj/"+sjid,function(date){
		$(".tmsl").html(date.tmsum);
		$(".tmzf").html(date.score);
		var sum=date.tmsum;
		var score=date.score;
		var dgfs=parseInt(score)/parseInt(sum);
		$(".dgtmfs").html(dgfs);
	})
}

//查询考试题目
function cxsjtm(){
	
	var is=1;
	var sjid=$(".sjid").html();
	$(".shijuannr").html("");
	
	$.ajaxSettings.async = false;
	$.getJSON("cxsjtm/"+sjid,function(date){
		$.each(date,function(){ 	
			
			var cls="radio";
			if(this.idDouble==2){
				cls="checkbox";
			}
			
			var div=$("<div class=\"dgtm\" id='"+(is+1)+"index' tmid=\""+this.qtId+"\">"
			        +"<p style=\"margin-left: 0\" ><label class='bs'>"+is+"</label>."+this.qtQuest+"</p>"
			        +"<div class=\"daan\">"			            
			        +"</div></div>");
			
			$(".shijuannr").append(div);
			
			$.each(this.list,function(i,obj){
				 div.find(".daan").append("<p onclick='txdaan(this)'>"
						 +"<input type='"+cls+"' onclick=\"txdaan(this)\" name='dx"+is+"' style=\"width: 15px;height: 15px\" isRight='"+obj.isRight+"'></i>"
						 +" <span>"+obj.opORder+"</span>."+obj.rightOption+"</p>"); 
			})
			is++;
		});
		
		$(".dgtm:eq(0)").css("border-top","0");
	})
	
	cjdtk();
}

//填充答题卡
function cjdtk(){
	var sum=$(".shijuannr .dgtm");

	$(".dgtmda").html("");
	for(var i=1;i<=sum.length;i++){
		$(".dgtmda").append("<div class=\"tmbx\"><a href='#"+i+"index'>"+i+"</a></div>");
	}
	$(".dgtmda").append("<div class=\"clear\" style=\"border: 0\"></div>");
}

function txdaan(th){
	var xx=$(th).parents(".daan").find("input");
	for(var i=0;i<xx.length;i++){
		
		var xh=$(th).parents(".dgtm").find(".bs").html();
		var dtk=$(".dgtmda .tmbx a");	

		if($(xx[i]).prop("checked")==true){
			
			for(var is=0;is<dtk.length;is++){

				if($(dtk[is]).html()==xh){
					$(dtk[is]).parent().css("background-color","#0088DB");
					$(dtk[is]).css("color","white");
				}
			}
			break;
		}else if(i==xx.length-1){
			for(var i=0;i<dtk.length;i++){
				if($(dtk[i]).html()==xh){
					$(dtk[i]).parent().css("background-color","white");
					$(dtk[i]).css("color","#337ab7");
				}
			}
		}
	}
}
</script>
    <script type="text/javascript">
        $(document).ready(function() {
            var date_str = "";
            for (var i = 0; i <= 23; i++) {
                var d_;
                i < 10 ? d_ = "0" + i : d_ = i;
                date_str = date_str + "<option>" + d_ + "</option><br/>"
            }
            $("#_minute").append(date_str);
            var time_str = "";
            for (var i = 0; i <= 59; i++) {
                var t_;
                i < 10 ? t_ = "0" + i : t_ = i;
                time_str = time_str + "<option>" + t_ + "</option><br/>"
            }
            $("#_second").append(time_str);
        });
        $(document).ready(function() {
                var m_ = $(".djs").html();
                var s_ = 00;
                seconds_ = m_ * 60 + s_ * 1;
         /*   $("#reset_").click(function() {
                $("#_minute").val("00");
                $("#_second").val("00");
                seconds_ = 0;
                clearInterval(timer);
            });*/
        });
    </script>
</body>
</html>